import{a as F}from"./chunk-TBHU6ZU3.js";import{b as $,c as U}from"./chunk-MZQCBFKV.js";import{a as R,b as Y}from"./chunk-X7KCC4V3.js";import"./chunk-GKJMT5CE.js";import{a as z,b as B}from"./chunk-KD4OITAO.js";import"./chunk-V3RLZPWU.js";import"./chunk-4O3FVBGX.js";import{b as K}from"./chunk-DUHWH566.js";import"./chunk-MAKQHRFT.js";import{g as V,h as D}from"./chunk-OVN2A4WB.js";import{b as j}from"./chunk-XEILQOEW.js";import{a as H,b as N}from"./chunk-BK62AMNQ.js";import{Aa as b,Ea as E,k as O,l as k,r as w,z as M}from"./chunk-IGLYEISI.js";import{$ as g,$a as p,Ab as c,Ba as C,Da as n,Oa as f,Ob as m,P as I,Pb as y,Qb as v,T,Va as P,Wb as A,_ as u,lb as a,mb as r,nb as o,ob as l,vb as _,zb as S}from"./chunk-GHXVRSLK.js";var h=class i{constructor(t){this.http=t}storeApiUrl="/api/store";getAvatars(){return this.http.get(`${this.storeApiUrl}/avatars`)}getCart(){return this.http.get(`${this.storeApiUrl}/cart`)}addToCart(t,e){return this.http.post(`${this.storeApiUrl}/cart`,{itemId:t,itemType:e})}removeFromCart(t){return this.http.delete(`${this.storeApiUrl}/cart/${t}`)}checkout(){return this.http.post(`${this.storeApiUrl}/checkout`,{})}getOrders(){return this.http.get(`${this.storeApiUrl}/orders`)}static \u0275fac=function(e){return new(e||i)(T(M))};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};function L(i,t){i&1&&(l(0,"i",6),m(1," Avatar Ma\u011Fazas\u0131 "))}function Q(i,t){i&1&&l(0,"p-progressSpinner")}function W(i,t){if(i&1){let e=_();r(0,"div",9)(1,"div",10),l(2,"img",11),r(3,"div",12)(4,"span",13),m(5),o(),r(6,"div",14),l(7,"i",15),r(8,"span"),m(9),o()(),r(10,"p-button",16),S("click",function(){let d=u(e).$implicit,x=c(2);return g(x.addToCart(d))}),o()()()()}if(i&2){let e=t.$implicit,s=c(2);n(2),a("src",e.image_path,C)("alt",e.name),n(3),y(e.name),n(4),v("",e.cost," Puan"),n(),a("label",s.isItemInCart(e.id)?"Sepette":"Sepete Ekle")("icon",s.isItemInCart(e.id)?"pi pi-check":"pi pi-cart-plus")("disabled",s.isItemInCart(e.id))}}function X(i,t){if(i&1&&(r(0,"div",7),p(1,W,11,7,"div",8),o()),i&2){let e=c();n(),a("ngForOf",e.storeAvatars)}}function Z(i,t){i&1&&(l(0,"i",17),m(1," Sepetim "))}function ee(i,t){i&1&&l(0,"p-progressSpinner")}function te(i,t){if(i&1){let e=_();r(0,"li",25)(1,"div",26),l(2,"img",27),r(3,"div")(4,"div",28),m(5),o(),r(6,"div",29),m(7),o()()(),r(8,"p-button",30),S("click",function(){let d=u(e).$implicit,x=c(3);return g(x.removeFromCart(d.id))}),o()()}if(i&2){let e=t.$implicit;n(2),a("src",e.image_path,C)("alt",e.name),n(3),y(e.name),n(2),v("",e.cost," Puan")}}function ie(i,t){i&1&&(r(0,"small",31),m(1,"Sat\u0131n almak i\xE7in yeterli puan\u0131n yok."),o())}function re(i,t){if(i&1){let e=_();r(0,"div")(1,"ul",19),p(2,te,9,4,"li",20),o(),l(3,"p-divider"),r(4,"div",21)(5,"span"),m(6,"Toplam:"),o(),r(7,"span"),m(8),o()(),r(9,"div",22),m(10),o(),r(11,"p-button",23),S("click",function(){u(e);let d=c(2);return g(d.checkout())}),o(),p(12,ie,2,0,"small",24),o()}if(i&2){let e=c(2);n(2),a("ngForOf",e.cartItems),n(6),v("",e.cartTotal," Puan"),n(2),v(" Mevcut Puan\u0131n: ",e.userPoints," "),n(),a("disabled",e.cartTotal>e.userPoints||e.cartItems.length===0),n(),a("ngIf",e.cartTotal>e.userPoints)}}function ne(i,t){i&1&&(r(0,"div",32),l(1,"i",33),r(2,"p",34),m(3,"Sepetin bo\u015F."),o()())}function oe(i,t){if(i&1&&(r(0,"div"),p(1,re,13,5,"div",3)(2,ne,4,0,"div",18),o()),i&2){let e=c();n(),a("ngIf",e.cartItems.length>0),n(),a("ngIf",e.cartItems.length===0)}}var q=class i{constructor(t,e,s){this.storeService=t;this.authService=e;this.messageService=s}storeAvatars=[];cartItems=[];loadingStore=!0;loadingCart=!0;userPoints=0;pointsSubscription;ngOnInit(){this.pointsSubscription=this.authService.userPoints$.subscribe(t=>{this.userPoints=t}),this.loadStoreAvatars(),this.loadCart()}loadStoreAvatars(){this.loadingStore=!0,this.storeService.getAvatars().subscribe(t=>{this.storeAvatars=t,this.loadingStore=!1})}ngOnDestroy(){this.pointsSubscription&&this.pointsSubscription.unsubscribe()}loadCart(){this.loadingCart=!0,this.storeService.getCart().subscribe(t=>{this.cartItems=t,this.loadingCart=!1})}addToCart(t){this.storeService.addToCart(t.id,"avatar").subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Ba\u015Far\u0131l\u0131",detail:e.message}),this.loadCart()},error:e=>this.messageService.add({severity:"error",summary:"Hata",detail:e.error.message||"\xDCr\xFCn eklenemedi."})})}removeFromCart(t){this.storeService.removeFromCart(t).subscribe({next:e=>{this.messageService.add({severity:"info",summary:"Kald\u0131r\u0131ld\u0131",detail:e.message}),this.loadCart()},error:e=>this.messageService.add({severity:"error",summary:"Hata",detail:e.error.message||"\xDCr\xFCn kald\u0131r\u0131lamad\u0131."})})}get cartTotal(){return this.cartItems.reduce((t,e)=>t+e.cost,0)}checkout(){this.storeService.checkout().subscribe({next:t=>{this.messageService.add({severity:"success",summary:"Sipari\u015F Al\u0131nd\u0131!",detail:t.message,life:5e3}),this.userPoints=t.newPoints,this.authService.updateUserPoints(t.newPoints),this.cartItems=[]},error:t=>this.messageService.add({severity:"error",summary:"Hata",detail:t.error.message||"Sipari\u015F verilemedi."})})}isItemInCart(t){return this.cartItems.some(e=>e.id===t)}static \u0275fac=function(e){return new(e||i)(f(h),f(F),f(b))};static \u0275cmp=P({type:i,selectors:[["app-store"]],features:[A([b])],decls:12,vars:4,consts:[[1,"store-page","grid"],[1,"col-12","lg:col-8"],["pTemplate","title"],[4,"ngIf"],["class","grid",4,"ngIf"],[1,"col-12","lg:col-4"],[1,"pi","pi-shopping-bag","mr-2"],[1,"grid"],["class","col-6 md:col-4 lg:col-3",4,"ngFor","ngForOf"],[1,"col-6","md:col-4","lg:col-3"],[1,"store-item"],[1,"store-item-image",3,"src","alt"],[1,"store-item-details"],[1,"item-name"],[1,"item-cost"],[1,"pi","pi-star-fill","text-yellow-500","mr-1"],["styleClass","p-button-sm mt-2",3,"click","label","icon","disabled"],[1,"pi","pi-shopping-cart","mr-2"],["class","text-center p-4",4,"ngIf"],[1,"list-none","p-0","m-0"],["class","flex align-items-center justify-content-between mb-3",4,"ngFor","ngForOf"],[1,"flex","justify-content-between","font-bold","text-lg","mb-3"],[1,"text-center","text-sm","text-color-secondary","mb-3"],["label","Sat\u0131n Al","icon","pi pi-check","styleClass","w-full",3,"click","disabled"],["class","p-error block text-center mt-2",4,"ngIf"],[1,"flex","align-items-center","justify-content-between","mb-3"],[1,"flex","align-items-center"],[1,"cart-item-image","mr-2",3,"src","alt"],[1,"font-semibold"],[1,"text-sm","text-color-secondary"],["icon","pi pi-trash","styleClass","p-button-danger p-button-text p-button-rounded",3,"click"],[1,"p-error","block","text-center","mt-2"],[1,"text-center","p-4"],[1,"pi","pi-cart-plus","text-4xl","text-color-secondary","mb-3"],[1,"text-color-secondary"]],template:function(e,s){e&1&&(l(0,"p-toast"),r(1,"div",0)(2,"div",1)(3,"p-card"),p(4,L,2,0,"ng-template",2)(5,Q,1,0,"p-progressSpinner",3)(6,X,2,1,"div",4),o()(),r(7,"div",5)(8,"p-card"),p(9,Z,2,0,"ng-template",2)(10,ee,1,0,"p-progressSpinner",3)(11,oe,3,2,"div",3),o()()()),e&2&&(n(5),a("ngIf",s.loadingStore),n(),a("ngIf",!s.loadingStore),n(4),a("ngIf",s.loadingCart),n(),a("ngIf",!s.loadingCart))},dependencies:[w,O,k,N,H,E,D,V,B,z,K,U,$,j,Y,R],styles:[".store-item[_ngcontent-%COMP%]{border:1px solid var(--surface-border);border-radius:var(--border-radius);text-align:center;transition:all .2s ease-in-out;background:var(--surface-card)}.store-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 12px #0000001a}.store-item-image[_ngcontent-%COMP%]{width:100%;height:150px;object-fit:cover;border-top-left-radius:var(--border-radius);border-top-right-radius:var(--border-radius)}.store-item-details[_ngcontent-%COMP%]{padding:1rem}.item-name[_ngcontent-%COMP%]{font-weight:600;display:block;margin-bottom:.5rem}.item-cost[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--text-color-secondary)}.cart-item-image[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:50%;object-fit:cover}"]})};export{q as StoreComponent};
