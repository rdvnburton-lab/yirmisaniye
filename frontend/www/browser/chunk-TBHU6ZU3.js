import{f as m}from"./chunk-GKJMT5CE.js";import{z as g}from"./chunk-IGLYEISI.js";import{L as s,P as l,T as a,ha as n,k as i}from"./chunk-GHXVRSLK.js";var u=class r{constructor(t,e){this.http=t;this.router=e;let o=localStorage.getItem("points"),c=o?parseInt(o,10):0;this.userPointsSubject.next(c),this.userProfileImage.set(localStorage.getItem("profile_picture")||"assets/images/avatar-placeholder.png")}apiUrl="/api/auth";userPointsSubject=new i(0);userPoints$=this.userPointsSubject.asObservable();userProfileImage=n("assets/images/avatar-placeholder.png");login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(s(e=>{e&&e.token&&(this.clearUserData(),localStorage.setItem("authToken",e.token),localStorage.setItem("username",e.username),localStorage.setItem("email",t.email),localStorage.setItem("points",e.points?.toString()||"0"),localStorage.setItem("profile_picture",e.profile_picture||""),localStorage.setItem("role",e.role||"user"),this.userPointsSubject.next(e.points||0),this.userProfileImage.set(e.profile_picture||"assets/images/avatar-placeholder.png"))}))}register(t){return this.http.post(`${this.apiUrl}/register`,t)}changePassword(t){return this.http.post(`${this.apiUrl}/change-password`,t)}clearUserData(){localStorage.removeItem("authToken"),localStorage.removeItem("username"),localStorage.removeItem("email"),localStorage.removeItem("points"),localStorage.removeItem("profile_picture")}logout(){this.userPointsSubject.next(0),this.userProfileImage.set("assets/images/avatar-placeholder.png"),this.clearUserData(),this.router.navigate(["/login"],{state:{logoutSuccess:!0}})}isAuthenticated(){return!!localStorage.getItem("authToken")}isAdmin(){return this.isAuthenticated()&&localStorage.getItem("role")==="admin"}getUsername(){return localStorage.getItem("username")}getEmail(){return localStorage.getItem("email")}getUserPoints(){let t=localStorage.getItem("points");return t?parseInt(t,10):0}getUserProfileImage(){return localStorage.getItem("profile_picture")||"assets/images/avatar-placeholder.png"}updateUserProfileImage(t){localStorage.setItem("profile_picture",t)}updateUserPoints(t){localStorage.setItem("points",t.toString()),this.userPointsSubject.next(t)}static \u0275fac=function(e){return new(e||r)(a(g),a(m))};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{u as a};
