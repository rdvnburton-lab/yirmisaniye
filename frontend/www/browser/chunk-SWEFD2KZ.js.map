{
  "version": 3,
  "sources": ["src/app/pages/auth/auth.service.ts"],
  "sourcesContent": ["import { Injectable, signal } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, tap, BehaviorSubject } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n\r\n  private apiUrl = '/api/auth'; // Proxy sayesinde tam adres yazmamıza gerek yok\r\n\r\n  // Puanı anlık olarak tutmak ve yayınlamak için BehaviorSubject\r\n  private userPointsSubject = new BehaviorSubject<number>(0);\r\n  public userPoints$ = this.userPointsSubject.asObservable();\r\n\r\n  // Profil resmini anlık olarak tutmak ve yayınlamak için signal\r\n  public userProfileImage = signal<string>('assets/images/avatar-placeholder.png');\r\n\r\n  constructor(private http: HttpClient, private router: Router) {\r\n    // Servis ilk yüklendiğinde localStorage'dan puanı alıp yayınla\r\n    const pointsStr = localStorage.getItem('points');\r\n    const initialPoints = pointsStr ? parseInt(pointsStr, 10) : 0;\r\n    this.userPointsSubject.next(initialPoints);\r\n    this.userProfileImage.set(localStorage.getItem('profile_picture') || 'assets/images/avatar-placeholder.png');\r\n  }\r\n\r\n  login(credentials: { email: string, password: string }): Observable<any> {\r\n    return this.http.post(`${this.apiUrl}/login`, credentials).pipe(\r\n      tap((response: any) => {\r\n        // Gelen token'ı localStorage'a kaydet\r\n        if (response && response.token) {\r\n          // Önce tüm eski verileri temizle\r\n          this.clearUserData();\r\n          localStorage.setItem('authToken', response.token);\r\n          localStorage.setItem('username', response.username); // Kullanıcı adını kaydet\r\n          localStorage.setItem('email', credentials.email); // Email'i kaydet\r\n          localStorage.setItem('points', response.points?.toString() || '0'); // Puanları kaydet\r\n          localStorage.setItem('profile_picture', response.profile_picture || ''); // Profil resmini kaydet\r\n          // Puan değişikliğini yayınla\r\n          this.userPointsSubject.next(response.points || 0);\r\n          this.userProfileImage.set(response.profile_picture || 'assets/images/avatar-placeholder.png');\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  register(userData: { username: string, email: string, password: string }): Observable<any> {\r\n    return this.http.post(`${this.apiUrl}/register`, userData);\r\n  }\r\n\r\n  changePassword(passwords: { currentPassword: string, newPassword: string }): Observable<any> {\r\n    return this.http.post(`${this.apiUrl}/change-password`, passwords);\r\n  }\r\n\r\n  private clearUserData(): void {\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('username');\r\n    localStorage.removeItem('email');\r\n    localStorage.removeItem('points');\r\n    localStorage.removeItem('profile_picture');\r\n  }\r\n\r\n  logout() {\r\n    this.userPointsSubject.next(0); // Çıkış yapıldığında puanı sıfırla\r\n    this.userProfileImage.set('assets/images/avatar-placeholder.png'); // Profil resmini sıfırla\r\n    this.clearUserData();\r\n    this.router.navigate(['/login'], { state: { logoutSuccess: true } });\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    // localStorage'da token olup olmadığını kontrol et\r\n    const token = localStorage.getItem('authToken');\r\n    // Token varsa true, yoksa false döndür.\r\n    // Daha gelişmiş bir yapıda token'ın geçerlilik süresi de kontrol edilebilir.\r\n    return !!token;\r\n  }\r\n\r\n  getUsername(): string | null {\r\n    return localStorage.getItem('username');\r\n  }\r\n\r\n  getEmail(): string | null {\r\n    return localStorage.getItem('email');\r\n  }\r\n\r\n  getUserPoints(): number {\r\n    const pointsStr = localStorage.getItem('points');\r\n    return pointsStr ? parseInt(pointsStr, 10) : 0;\r\n  }\r\n\r\n  getUserProfileImage(): string {\r\n    return localStorage.getItem('profile_picture') || 'assets/images/avatar-placeholder.png';\r\n  }\r\n   updateUserProfileImage(imagePath: string): void {\r\n    localStorage.setItem('profile_picture', imagePath);\r\n    // Optional: Notify other components of the change using a BehaviorSubject if needed.\r\n    // For now, a page refresh will show the new avatar in the topbar.\r\n  }\r\n\r\n  updateUserPoints(newPoints: number): void {\r\n    localStorage.setItem('points', newPoints.toString());\r\n    this.userPointsSubject.next(newPoints);\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAQM,IAAO,cAAP,MAAO,aAAW;EAWF;EAA0B;EATtC,SAAS;;;EAGT,oBAAoB,IAAI,gBAAwB,CAAC;EAClD,cAAc,KAAK,kBAAkB,aAAY;;EAGjD,mBAAmB,OAAe,wCAAsC,GAAA,YAAA,CAAA,EAAA,WAAA,mBAAA,CAAA,IAAA,CAAA,CAAA;EAE/E,YAAoB,MAA0B,QAAc;AAAxC,SAAA,OAAA;AAA0B,SAAA,SAAA;AAE5C,UAAM,YAAY,aAAa,QAAQ,QAAQ;AAC/C,UAAM,gBAAgB,YAAY,SAAS,WAAW,EAAE,IAAI;AAC5D,SAAK,kBAAkB,KAAK,aAAa;AACzC,SAAK,iBAAiB,IAAI,aAAa,QAAQ,iBAAiB,KAAK,sCAAsC;EAC7G;EAEA,MAAM,aAAgD;AACpD,WAAO,KAAK,KAAK,KAAK,GAAG,KAAK,MAAM,UAAU,WAAW,EAAE,KACzD,IAAI,CAAC,aAAiB;AAEpB,UAAI,YAAY,SAAS,OAAO;AAE9B,aAAK,cAAa;AAClB,qBAAa,QAAQ,aAAa,SAAS,KAAK;AAChD,qBAAa,QAAQ,YAAY,SAAS,QAAQ;AAClD,qBAAa,QAAQ,SAAS,YAAY,KAAK;AAC/C,qBAAa,QAAQ,UAAU,SAAS,QAAQ,SAAQ,KAAM,GAAG;AACjE,qBAAa,QAAQ,mBAAmB,SAAS,mBAAmB,EAAE;AAEtE,aAAK,kBAAkB,KAAK,SAAS,UAAU,CAAC;AAChD,aAAK,iBAAiB,IAAI,SAAS,mBAAmB,sCAAsC;MAC9F;IACF,CAAC,CAAC;EAEN;EAEA,SAAS,UAA+D;AACtE,WAAO,KAAK,KAAK,KAAK,GAAG,KAAK,MAAM,aAAa,QAAQ;EAC3D;EAEA,eAAe,WAA2D;AACxE,WAAO,KAAK,KAAK,KAAK,GAAG,KAAK,MAAM,oBAAoB,SAAS;EACnE;EAEQ,gBAAa;AACnB,iBAAa,WAAW,WAAW;AACnC,iBAAa,WAAW,UAAU;AAClC,iBAAa,WAAW,OAAO;AAC/B,iBAAa,WAAW,QAAQ;AAChC,iBAAa,WAAW,iBAAiB;EAC3C;EAEA,SAAM;AACJ,SAAK,kBAAkB,KAAK,CAAC;AAC7B,SAAK,iBAAiB,IAAI,sCAAsC;AAChE,SAAK,cAAa;AAClB,SAAK,OAAO,SAAS,CAAC,QAAQ,GAAG,EAAE,OAAO,EAAE,eAAe,KAAI,EAAE,CAAE;EACrE;EAEA,kBAAe;AAEb,UAAM,QAAQ,aAAa,QAAQ,WAAW;AAG9C,WAAO,CAAC,CAAC;EACX;EAEA,cAAW;AACT,WAAO,aAAa,QAAQ,UAAU;EACxC;EAEA,WAAQ;AACN,WAAO,aAAa,QAAQ,OAAO;EACrC;EAEA,gBAAa;AACX,UAAM,YAAY,aAAa,QAAQ,QAAQ;AAC/C,WAAO,YAAY,SAAS,WAAW,EAAE,IAAI;EAC/C;EAEA,sBAAmB;AACjB,WAAO,aAAa,QAAQ,iBAAiB,KAAK;EACpD;EACC,uBAAuB,WAAiB;AACvC,iBAAa,QAAQ,mBAAmB,SAAS;EAGnD;EAEA,iBAAiB,WAAiB;AAChC,iBAAa,QAAQ,UAAU,UAAU,SAAQ,CAAE;AACnD,SAAK,kBAAkB,KAAK,SAAS;EACvC;;qCA/FW,cAAW,mBAAA,UAAA,GAAA,mBAAA,MAAA,CAAA;EAAA;4EAAX,cAAW,SAAX,aAAW,WAAA,YAFV,OAAM,CAAA;;;sEAEP,aAAW,CAAA;UAHvB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
