<p-toast></p-toast>
<div class="store-page grid">
    <!-- Mağaza Ürünleri -->
    <div class="col-12 lg:col-8">
        <p-card>
            <ng-template pTemplate="title">
                <i class="pi pi-shopping-bag mr-2"></i> Avatar Mağazası
            </ng-template>
            <p-progressSpinner *ngIf="loadingStore"></p-progressSpinner>
            <div *ngIf="!loadingStore" class="grid">
                <div *ngFor="let avatar of storeAvatars" class="col-6 md:col-4 lg:col-3">
                    <div class="store-item">
                        <img [src]="avatar.image_path" [alt]="avatar.name" class="store-item-image">
                        <div class="store-item-details">
                            <span class="item-name">{{ avatar.name }}</span>
                            <div class="item-cost">
                                <i class="pi pi-star-fill text-yellow-500 mr-1"></i>
                                <span>{{ avatar.cost }} Puan</span>
                            </div>
                            <p-button [label]="isItemInCart(avatar.id) ? 'Sepette' : 'Sepete Ekle'"
                                [icon]="isItemInCart(avatar.id) ? 'pi pi-check' : 'pi pi-cart-plus'"
                                [disabled]="isItemInCart(avatar.id)" (click)="addToCart(avatar)"
                                styleClass="p-button-sm mt-2">
                            </p-button>
                        </div>
                    </div>
                </div>
            </div>
        </p-card>
    </div>

    <!-- Alışveriş Sepeti -->
    <div class="col-12 lg:col-4">
        <p-card>
            <ng-template pTemplate="title">
                <i class="pi pi-shopping-cart mr-2"></i> Sepetim
            </ng-template>
            <p-progressSpinner *ngIf="loadingCart"></p-progressSpinner>
            <div *ngIf="!loadingCart">
                <div *ngIf="cartItems.length > 0">
                    <ul class="list-none p-0 m-0">
                        <li *ngFor="let item of cartItems" class="flex align-items-center justify-content-between mb-3">
                            <div class="flex align-items-center">
                                <img [src]="item.image_path" [alt]="item.name" class="cart-item-image mr-2">
                                <div>
                                    <div class="font-semibold">{{ item.name }}</div>
                                    <div class="text-sm text-color-secondary">{{ item.cost }} Puan</div>
                                </div>
                            </div>
                            <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-text p-button-rounded"
                                (click)="removeFromCart(item.id)"></p-button>
                        </li>
                    </ul>
                    <p-divider></p-divider>
                    <div class="flex justify-content-between font-bold text-lg mb-3">
                        <span>Toplam:</span>
                        <span>{{ cartTotal }} Puan</span>
                    </div>
                    <div class="text-center text-sm text-color-secondary mb-3">
                        Mevcut Puanın: {{ userPoints }}
                    </div>
                    <p-button label="Satın Al" icon="pi pi-check" styleClass="w-full"
                        [disabled]="cartTotal > userPoints || cartItems.length === 0" (click)="checkout()">
                    </p-button>
                    <small *ngIf="cartTotal > userPoints" class="p-error block text-center mt-2">Satın almak için
                        yeterli puanın yok.</small>
                </div>
                <div *ngIf="cartItems.length === 0" class="text-center p-4">
                    <i class="pi pi-cart-plus text-4xl text-color-secondary mb-3"></i>
                    <p class="text-color-secondary">Sepetin boş.</p>
                </div>
            </div>
        </p-card>
    </div>
</div>